<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Республикалық Мектеп Олимпиадалары</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #2980b9;
            --accent-color: #27ae60;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f9f9f9;
            color: #333;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        body.dark-mode {
            background-color: #1a1a2e;
            color: #e6e6e6;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
            padding: 30px 0;
            position: relative;
            overflow: hidden;
        }
        
        .header-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo {
            font-size: 1.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .logo i {
            margin-right: 10px;
            color: var(--accent-color);
        }
        
        nav {
            background: var(--dark-color);
            padding: 10px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        nav a {
            color: white;
            text-decoration: none;
            margin: 0 10px;
            padding: 8px 12px;
            border-radius: 5px;
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        nav a:hover, nav a.active {
            background-color: var(--secondary-color);
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        body.dark-mode .container {
            background-color: #16213e;
            color: #e6e6e6;
        }
        
        .event {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        body.dark-mode .event {
            background-color: #1a1a2e;
        }
        
        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .event-date {
            background: var(--secondary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
        }
        
        .event-image {
            width: 100%;
            height: 200px;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .event-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .event-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
        }
        
        .detail-item i {
            margin-right: 8px;
            color: var(--secondary-color);
        }
        
        button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #2ecc71;
            transform: translateY(-2px);
        }
        
        footer {
            background: var(--primary-color);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 30px;
        }
        
        .social-links {
            margin: 15px 0;
        }
        
        .social-links a {
            color: white;
            font-size: 1.2rem;
            margin: 0 10px;
        }
        
        .form-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        body.dark-mode .form-container {
            background-color: #1a1a2e;
        }
        
        .form-container input, 
        .form-container textarea, 
        .form-container select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        body.dark-mode .form-container input,
        body.dark-mode .form-container textarea,
        body.dark-mode .form-container select {
            background-color: #2d3748;
            color: #e6e6e6;
            border-color: #4a5568;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        body.dark-mode .modal-content {
            background-color: #1a1a2e;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
        }
        
        .admin-panel {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        body.dark-mode .admin-panel {
            background-color: rgba(255,255,255,0.05);
        }
        
        .participants-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .participant-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        body.dark-mode .stat-card {
            background-color: #1a1a2e;
        }
        
        .stat-card i {
            font-size: 1.5rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        
        .stat-card .number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        body.dark-mode .stat-card .number {
            color: #e6e6e6;
        }
        
        .tab-container {
            margin-top: 20px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 15px;
            cursor: pointer;
        }
        
        .tab.active {
            border-bottom: 2px solid var(--secondary-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .telegram-section {
            margin: 20px 0;
            text-align: center;
        }
        
        .telegram-banner {
            background: linear-gradient(135deg, #0088cc, #34aadc);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 20px;
            cursor: pointer;
        }

        body.dark-mode .filter-btn {
            background-color: #2d3748;
            color: #e6e6e6;
        }
        
        .filter-btn.active {
            background: var(--secondary-color);
            color: white;
        }
        
        .dark-mode-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            z-index: 1000;
        }
        
        .notification-badge {
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
        }
        
        .success-message {
            background: var(--accent-color);
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }
        
        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 15px;
            }
            
            nav a {
                margin: 0 5px;
                padding: 6px 10px;
                font-size: 0.9rem;
            }
            
            .event-details {
                grid-template-columns: 1fr;
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .filter-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-trophy"></i>
                <span>Мектеп Олимпиадалары</span>
            </div>
            <p>Білімді жаңа деңгейге көтеріңіз!</p>
        </div>
    </header>
    
    <nav>
        <a href="#events" class="active">Іс-шаралар</a>
        <a href="#add-event">Іс-шара қосу</a>
        <a href="#admin">Әкімшілік</a>
        <a href="#results">Нәтижелер</a>
        <a href="#contact">Байланыс</a>
    </nav>
    
    <div class="container" id="events">
        <h2><i class="fas fa-calendar-check"></i> Ағымдағы Олимпиадалар</h2>
        
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">Барлығы</button>
            <button class="filter-btn" data-filter="olympiad">Олимпиадалар</button>
            <button class="filter-btn" data-filter="competition">Конкурстар</button>
        </div>
        
        <div class="stats-cards">
            <div class="stat-card">
                <i class="fas fa-calendar-day"></i>
                <div class="number" id="total-events">0</div>
                <div class="label">Іс-шаралар</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-users"></i>
                <div class="number" id="total-participants">0</div>
                <div class="label">Қатысушылар</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-school"></i>
                <div class="number" id="total-schools">0</div>
                <div class="label">Мектептер</div>
            </div>
        </div>
        
        <div id="events-list">
            <!-- Іс-шаралар осында пайда болады -->
        </div>
    </div>
    
    <div class="container" id="add-event">
        <h2><i class="fas fa-plus-square"></i> Жаңа Іс-шара Қосу</h2>
        <button class="add-event-btn" id="toggleFormBtn">Іс-шара қосу формасын ашу</button>
        
        <div class="form-container" id="eventForm" style="display: none;">
            <form id="newEventForm">
                <h3>Іс-шара ақпараты</h3>
                <input type="text" id="eventName" placeholder="Іс-шара атауы" required>
                <input type="date" id="eventDate" required>
                <input type="text" id="eventLocation" placeholder="Орын" required>
                <select id="eventType" required>
                    <option value="">Іс-шара түрін таңдаңыз</option>
                    <option value="olympiad">Олимпиада</option>
                    <option value="competition">Конкурс</option>
                    <option value="seminar">Семинар</option>
                </select>
                <textarea id="eventDescription" placeholder="Сипаттама" rows="3" required></textarea>
                <input type="url" id="eventImage" placeholder="Сурет URL">
                <button type="submit">Іс-шараны қосу</button>
            </form>
            <div class="success-message" id="successMessage">
                Іс-шара сәтті қосылды!
            </div>
        </div>
    </div>
    
    <div class="container" id="admin">
        <h2><i class="fas fa-user-shield"></i> Әкімшілік Панелі</h2>
        
        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" data-tab="participants">Қатысушылар</div>
                <div class="tab" data-tab="events">Іс-шаралар</div>
            </div>
            
            <div class="tab-content active" id="participants-tab">
                <div class="admin-panel">
                    <h3>Тіркелген қатысушылар</h3>
                    <div class="participants-list" id="participants-list">
                        <!-- Қатысушылар тізімі -->
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="events-tab">
                <div class="admin-panel">
                    <h3>Іс-шараларды басқару</h3>
                    <div id="admin-events-list">
                        <!-- Іс-шаралар тізімі -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container" id="results">
        <h2><i class="fas fa-chart-line"></i> Нәтижелер</h2>
        <div id="results-content">
            <p>Нәтижелер жақын арада жарияланады...</p>
        </div>
    </div>
    
    <div class="container" id="contact">
        <h2><i class="fas fa-envelope"></i> Байланыс</h2>
        
        <div class="telegram-section">
            <div class="telegram-banner">
                <i class="fab fa-telegram"></i>
                <h3>Біздің Telegram ботымыз</h3>
                <p>@smart_olimpyada_bot</p>
                <button id="telegram-btn">Ботқа қосылу</button>
            </div>
        </div>
        
        <div class="founder-info">
            <h3>Негізін қалаушы</h3>
            <p>Скендерова Арай</p>
            <p>Телефон: +7-776-742-6757</p>
            <p>Email: aray.skenderova@mail.ru</p>
        </div>
    </div>
    
    <footer>
        <div class="social-links">
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="https://t.me/smart_olimpyada_bot"><i class="fab fa-telegram"></i></a>
        </div>
        <p>&copy; 2025 Республикалық Мектеп Олимпиадалары</p>
    </footer>
    
    <!-- Тіркелу модальды терезесі -->
    <div id="registrationModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Тіркелу</h2>
            <form id="registrationForm">
                <input type="hidden" id="eventIdForRegistration">
                <input type="text" id="participantName" placeholder="Аты-жөніңіз" required>
                <input type="email" id="participantEmail" placeholder="Email" required>
                <input type="tel" id="participantPhone" placeholder="Телефон" required>
                <input type="text" id="participantSchool" placeholder="Мектеп" required>
                <input type="number" id="participantClass" placeholder="Сынып" required min="1" max="11">
                <input type="text" id="participantCity" placeholder="Қала" required>
                <button type="submit">Тіркелу</button>
            </form>
            <div class="success-message" id="registrationSuccess" style="display: none;">
                Сіз сәтті тіркелдіңіз!
            </div>
        </div>
    </div>
    
    <button class="dark-mode-toggle" id="darkModeToggle">
        <i class="fas fa-moon"></i>
    </button>

    <script>
        // Деректер базасы
        let events = [];
        let participants = [];

        // Жергілікті сақтаудан деректерді жүктеу
        function loadFromLocalStorage() {
            try {
                const savedEvents = localStorage.getItem('olimpiada_events');
                const savedParticipants = localStorage.getItem('olimpiada_participants');
                
                if (savedEvents) {
                    events = JSON.parse(savedEvents);
                }
                
                if (savedParticipants) {
                    participants = JSON.parse(savedParticipants);
                }
            } catch (e) {
                console.log('Жергілікті жүктеу қатесі:', e);
            }
        }

        // Жергілікті сақтауға деректерді сақтау
        function saveToLocalStorage() {
            try {
                localStorage.setItem('olimpiada_events', JSON.stringify(events));
                localStorage.setItem('olimpiada_participants', JSON.stringify(participants));
            } catch (e) {
                console.log('Жергілікті сақтау қатесі:', e);
            }
        }

        // Іс-шараларды көрсету
        function displayEvents(filter = 'all') {
            const eventsList = document.getElementById('events-list');
            eventsList.innerHTML = '';
            
            if (events.length === 0) {
                eventsList.innerHTML = '<p>Қазіргі уақытта іс-шаралар жоқ.</p>';
                return;
            }
            
            // Сүзгілеу
            let filteredEvents = events;
            if (filter !== 'all') {
                filteredEvents = events.filter(event => event.type === filter);
            }
            
            // Күні бойынша сұрыптау (ең жақын алдымен)
            filteredEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            filteredEvents.forEach(event => {
                const eventDate = new Date(event.date);
                const today = new Date();
                const daysDiff = Math.ceil((eventDate - today) / (1000 * 3600 * 24));
                
                let status = 'Алдағы';
                if (daysDiff < 0) {
                    status = 'Аяқталған';
                } else if (daysDiff === 0) {
                    status = 'Бүгін';
                } else if (daysDiff <= 3) {
                    status = 'Жедел';
                }
                
                const eventElement = document.createElement('div');
                eventElement.className = 'event';
                eventElement.innerHTML = `
                    <div class="event-header">
                        <h3>${event.name}</h3>
                        <div class="event-date">${formatDate(event.date)}</div>
                    </div>
                    ${event.image ? `
                    <div class="event-image">
                        <img src="${event.image}" alt="${event.name}">
                    </div>
                    ` : ''}
                    <div class="event-details">
                        <div class="detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${event.location}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-users"></i>
                            <span>${event.participants || 0} қатысушы</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-tag"></i>
                            <span>${getEventType(event.type)}</span>
                        </div>
                    </div>
                    <p>${event.description}</p>
                    <button onclick="openRegistrationModal(${event.id}, '${event.name}')">
                        <i class="fas fa-user-plus"></i> Тіркелу
                    </button>
                    ${status === 'Аяқталған' ? 
                    `<button onclick="showEventResults(${event.id})" style="background: #9b59b6;">
                        <i class="fas fa-chart-bar"></i> Нәтижелер
                    </button>` : ''}
                `;
                eventsList.appendChild(eventElement);
            });
            
            updateStats();
        }

        // Күнді пішімдеу
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('kk-KZ', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Іс-шара түрін алу
        function getEventType(type) {
            const types = {
                'olympiad': 'Олимпиада',
                'competition': 'Конкурс',
                'seminar': 'Семинар'
            };
            return types[type] || type;
        }

        // Статистиканы жаңарту
        function updateStats() {
            // Іс-шаралар саны
            document.getElementById('total-events').textContent = events.length;
            
            // Қатысушылар саны
            const totalParticipants = participants.length;
            document.getElementById('total-participants').textContent = totalParticipants;
            
            // Бірегей мектептер саны
            const uniqueSchools = [...new Set(participants.map(p => p.school))].length;
            document.getElementById('total-schools').textContent = uniqueSchools;
        }

        // Қатысушыларды көрсету
        function displayParticipants() {
            const participantsList = document.getElementById('participants-list');
            participantsList.innerHTML = '';
            
            if (participants.length === 0) {
                participantsList.innerHTML = '<p>Қатысушылар тізімі бос.</p>';
                return;
            }
            
            participants.forEach(participant => {
                const participantElement = document.createElement('div');
                participantElement.className = 'participant-item';
                participantElement.innerHTML = `
                    <div>
                        <strong>${participant.name}</strong><br>
                        <small>${participant.school}, ${participant.class} сынып</small>
                    </div>
                    <div>
                        <small>${participant.eventName}</small><br>
                        <small>${formatDate(participant.registeredAt)}</small>
                    </div>
                `;
                participantsList.appendChild(participantElement);
            });
        }

        // Әкімшілік іс-шаралар тізімін көрсету
        function displayAdminEvents() {
            const adminEventsList = document.getElementById('admin-events-list');
            adminEventsList.innerHTML = '';
            
            events.forEach(event => {
                const eventElement = document.createElement('div');
                eventElement.className = 'event';
                eventElement.innerHTML = `
                    <div class="event-header">
                        <h3>${event.name}</h3>
                        <div class="event-date">${formatDate(event.date)}</div>
                    </div>
                    <p>${event.description}</p>
                    <div class="event-details">
                        <div class="detail-item">
                            <i class="fas fa-users"></i>
                            <span>${event.participants || 0} қатысушы</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${event.location}</span>
                        </div>
                    </div>
                    <button onclick="editEvent(${event.id})">
                        <i class="fas fa-edit"></i> Өзгерту
                    </button>
                    <button onclick="deleteEvent(${event.id})" style="background: #e74c3c;">
                        <i class="fas fa-trash"></i> Жою
                    </button>
                `;
                adminEventsList.appendChild(eventElement);
            });
        }

        // Тіркелу модальды терезесі
        function openRegistrationModal(eventId, eventName) {
            const modal = document.getElementById('registrationModal');
            const modalTitle = modal.querySelector('h2');
            const eventIdInput = document.getElementById('eventIdForRegistration');
            
            modalTitle.textContent = `"${eventName}" іс-шарасына тіркелу`;
            eventIdInput.value = eventId;
            
            modal.style.display = 'block';
            
            // Жабу батырмасы
            modal.querySelector('.close-btn').onclick = function() {
                modal.style.display = 'none';
            };
            
            // Сыртқы басу арқылы жабу
            window.onclick = function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            };
        }

        // Іс-шара қосу
        function addEvent(eventData) {
            // ID алу
            const newId = events.length > 0 ? Math.max(...events.map(e => e.id)) + 1 : 1;
            
            const newEvent = {
                id: newId,
                name: eventData.name,
                date: eventData.date,
                location: eventData.location,
                type: eventData.type,
                description: eventData.description,
                image: eventData.image || '',
                participants: 0
            };
            
            events.push(newEvent);
            saveToLocalStorage();
            displayEvents();
            displayAdminEvents();
            
            // Хабарлама көрсету
            const successMessage = document.getElementById('successMessage');
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
            
            return newId;
        }

        // Іс-шараны өзгерту
        function editEvent(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;
            
            const newName = prompt('Жаңа атауы:', event.name);
            if (newName) {
                event.name = newName;
                saveToLocalStorage();
                displayEvents();
                displayAdminEvents();
            }
        }

        // Іс-шараны жою
        function deleteEvent(eventId) {
            if (confirm('Іс-шараны жоюға сенімдісіз бе?')) {
                events = events.filter(e => e.id !== eventId);
                saveToLocalStorage();
                displayEvents();
                displayAdminEvents();
            }
        }

        // Нәтижелерді көрсету
        function showEventResults(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;
            
            const eventParticipants = participants.filter(p => p.eventId === eventId);
            
            const modal = document.getElementById('registrationModal');
            const modalContent = modal.querySelector('.modal-content');
            const oldForm = modal.querySelector('form');
            const oldSuccess = modal.getElementById('registrationSuccess');
            
            // Ескі форманы жасыру
            if (oldForm) oldForm.style.display = 'none';
            if (oldSuccess) oldSuccess.style.display = 'none';
            
            // Ескі нәтижелерді жою
            const oldResults = modal.querySelector('.results-container');
            if (oldResults) oldResults.remove();
            
            // Жаңа нәтижелерді қосу
            const resultsDiv = document.createElement('div');
            resultsDiv.className = 'results-container';
            
            if (eventParticipants.length > 0) {
                resultsDiv.innerHTML = `
                    <h2>"${event.name}" нәтижелері</h2>
                    <table style="width:100%; border-collapse:collapse; margin-top:20px;">
                        <thead>
                            <tr style="background:#f0f0f0;">
                                <th style="padding:10px; text-align:left;">Орын</th>
                                <th style="padding:10px; text-align:left;">Оқушы</th>
                                <th style="padding:10px; text-align:left;">Мектеп</th>
                                <th style="padding:10px; text-align:left;">Ұпай</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${eventParticipants.map((p, index) => `
                                <tr>
                                    <td style="padding:10px;">${index + 1}</td>
                                    <td style="padding:10px;">${p.name}</td>
                                    <td style="padding:10px;">${p.school}</td>
                                    <td style="padding:10px;">${p.score || 'Жоқ'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                resultsDiv.innerHTML = '<p>Бұл іс-шарада қатысушылар жоқ.</p>';
            }
            
            modalContent.appendChild(resultsDiv);
            modal.style.display = 'block';
            
            // Жабу функциясын қайта орнату
            modal.querySelector('.close-btn').onclick = function() {
                modal.style.display = 'none';
                resultsDiv.remove();
                if (oldForm) oldForm.style.display = 'block';
            };
        }

        // Сүзгілеу
        function setupFilters() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Белсенді класты өзгерту
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Сүзгілеу
                    const filter = this.getAttribute('data-filter');
                    displayEvents(filter);
                });
            });
        }

        // Қараңғы режим
        function setupDarkMode() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
            
            darkModeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                
                if (document.body.classList.contains('dark-mode')) {
                    localStorage.setItem('darkMode', 'true');
                    this.innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    localStorage.setItem('darkMode', 'false');
                    this.innerHTML = '<i class="fas fa-moon"></i>';
                }
            });
        }

        // Навигация
        function setupNavigation() {
            const navLinks = document.querySelectorAll('nav a');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Белсенді класты өзгерту
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Бөлімге өту
                    const targetId = this.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 70,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        }

        // Табылар
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Белсенді класты өзгерту
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Мазмұнды көрсету/жасыру
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabId}-tab`) {
                            content.classList.add('active');
                        }
                    });
                });
            });
        }

        // Telegram бот
        function setupTelegramBot() {
            const telegramBtn = document.getElementById('telegram-btn');
            if (telegramBtn) {
                telegramBtn.addEventListener('click', function() {
                    window.open('https://t.me/smart_olimpyada_bot', '_blank');
                });
            }
        }

        // Бастапқы деректер
        function initializeSampleData() {
            if (events.length === 0) {
                events = [
                    {
                        id: 1,
                        name: "Математика Олимпиадасы",
                        date: "2025-04-15",
                        location: "ҚазҰУ",
                        type: "olympiad",
                        description: "Республикалық деңгейдегі математика олимпиадасы.",
                        image: "https://images.unsplash.com/photo-1635070041078-e363dbe005cb?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
                        participants: 5
                    },
                    {
                        id: 2,
                        name: "Ағылшын Тілі Конкурсы",
                        date: "2025-04-20",
                        location: "№5 мектеп",
                        type: "competition",
                        description: "Ағылшын тілі бойынша қалалық конкурс.",
                        image: "https://images.unsplash.com/photo-1546410531-bb4caa6b424d?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
                        participants: 3
                    }
                ];
            }
            
            if (participants.length === 0) {
                participants = [
                    {
                        id: 1,
                        name: "Құрманов Аслан",
                        email: "aslan@example.com",
                        phone: "+77771234567",
                        school: "№38 мектеп",
                        class: "10",
                        city: "Нұр-Сұлтан",
                        eventId: 1,
                        eventName: "Математика Олимпиадасы",
                        registeredAt: "2025-03-10",
                        score: 95
                    },
                    {
                        id: 2,
                        name: "Оразбаева Айгерім",
                        email: "aigerim@example.com",
                        phone: "+77772345678",
                        school: "Назарбаев мектебі",
                        class: "11",
                        city: "Алматы",
                        eventId: 2,
                        eventName: "Ағылшын Тілі Конкурсы",
                        registeredAt: "2025-03-12",
                        score: 88
                    }
                ];
            }
        }

        // Бастапқы инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Жергілікті деректерді жүктеу
            loadFromLocalStorage();
            
            // Бастапқы деректерді қосу (егер жоқ болса)
            initializeSampleData();
            
            // Деректерді көрсету
            displayEvents();
            displayParticipants();
            displayAdminEvents();
            
            // Функцияларды іске қосу
            setupFilters();
            setupDarkMode();
            setupNavigation();
            setupTabs();
            setupTelegramBot();
            
            // Іс-шара қосу формасы
            const toggleFormBtn = document.getElementById('toggleFormBtn');
            const eventForm = document.getElementById('eventForm');
            
            if (toggleFormBtn && eventForm) {
                toggleFormBtn.addEventListener('click', function() {
                    if (eventForm.style.display === 'none' || eventForm.style.display === '') {
                        eventForm.style.display = 'block';
                        this.textContent = 'Форманы жабу';
                    } else {
                        eventForm.style.display = 'none';
                        this.textContent = 'Іс-шара қосу формасын ашу';
                    }
                });
            }
            
            // Жаңа іс-шара формасы
            const newEventForm = document.getElementById('newEventForm');
            if (newEventForm) {
                newEventForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const eventData = {
                        name: document.getElementById('eventName').value,
                        date: document.getElementById('eventDate').value,
                        location: document.getElementById('eventLocation').value,
                        type: document.getElementById('eventType').value,
                        description: document.getElementById('eventDescription').value,
                        image: document.getElementById('eventImage').value || ''
                    };
                    
                    addEvent(eventData);
                    
                    // Форманы тазалау
                    this.reset();
                });
            }
            
            // Тіркелу формасы
            const registrationForm = document.getElementById('registrationForm');
            if (registrationForm) {
                registrationForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const eventId = parseInt(document.getElementById('eventIdForRegistration').value);
                    const event = events.find(e => e.id === eventId);
                    
                    if (!event) {
                        alert('Іс-шара табылмады!');
                        return;
                    }
                    
                    // Жаңа қатысушы
                    const newParticipant = {
                        id: participants.length > 0 ? Math.max(...participants.map(p => p.id)) + 1 : 1,
                        name: document.getElementById('participantName').value,
                        email: document.getElementById('participantEmail').value,
                        phone: document.getElementById('participantPhone').value,
                        school: document.getElementById('participantSchool').value,
                        class: document.getElementById('participantClass').value,
                        city: document.getElementById('participantCity').value,
                        eventId: eventId,
                        eventName: event.name,
                        registeredAt: new Date().toISOString().split('T')[0],
                        score: Math.floor(Math.random() * 30) + 70 // Кездейсоқ ұпай
                    };
                    
                    participants.push(newParticipant);
                    
                    // Іс-шараға қатысушы санын қосу
                    event.participants = (event.participants || 0) + 1;
                    
                    // Деректерді сақтау
                    saveToLocalStorage();
                    
                    // Көрсетілетін деректерді жаңарту
                    displayEvents();
                    displayParticipants();
                    displayAdminEvents();
                    
                    // Форманы тазалау
                    this.reset();
                    
                    // Сәттілік хабарламасы
                    const successMessage = document.getElementById('registrationSuccess');
                    successMessage.style.display = 'block';
                    
                    // Модальды терезені жабу
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                        document.getElementById('registrationModal').style.display = 'none';
                    }, 3000);
                });
            }
        });
    </script>
</body>
</html>
